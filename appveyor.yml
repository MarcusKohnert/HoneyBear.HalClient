version: 1.0.{build}
skip_tags: true
configuration: Release
platform: Any CPU
environment:
  # Don't report back to the mothership
  DOTNET_CLI_TELEMETRY_OPTOUT: 1
assembly_info:
  patch: true
  file: "**\AssemblyInfo.*"
  assembly_version: "{version}"
  assembly_file_version: "{version}"
  assembly_informational_version: "{version}"
before_build:
- ps: >-
    appveyor-retry dotnet restore -v Minimal

    $json = Get-Content .\Src\HoneyBear.HalClient\project.json -raw | ConvertFrom-Json
    $json.version = $env:VERSION
    $json | ConvertTo-Json | Set-Content .\Src\HoneyBear.HalClient\project.json
build_script:
- dotnet build ".\Src\HoneyBear.HalClient" -c %CONFIGURATION%
after_build:
- dotnet pack ".\Src\HoneyBear.HalClient" -c %CONFIGURATION% --no-build -o artifacts
test_script:
- dotnet test ".\Src\HoneyBear.HalClient.Unit.Tests" -c %CONFIGURATION%
after_test:
- cmd: >-
    %USERPROFILE%\.nuget\packages\OpenCover\4.6.519\tools\OpenCover.Console.exe -register:user -filter:"+[HoneyBear.HalClient]*" -target:".\Src\HoneyBear.HalClient.Unit.Tests\bin\%CONFIGURATION%\net452\win7-x64\dotnet-test-nunit.exe" -targetargs:".\Src\HoneyBear.HalClient.Unit.Tests\bin\%CONFIGURATION%\net452\win7-x64\HoneyBear.HalClient.Unit.Tests.dll" -output:coverage.xml

    %USERPROFILE%\.nuget\packages\coveralls.io\1.3.4\tools\coveralls.net.exe --opencover coverage.xml --repo-token hOBugtrP7A2crVX8BA0cT9E8GjnlK8bcP
artifacts:
- path: artifacts\**\*.*
cache:
- "%USERPROFILE%\.nuget\packages"